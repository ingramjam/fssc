<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSSC Judge Bot - Official Trial</title>
    <style>
        /* --- Color Palette from Logo --- */
        :root {
            --fssc-navy: #1A237E; /* Deep Navy Blue (Primary) */
            --fssc-gold: #FFD700; /* Rich Gold (Accent) */
            --fssc-burgundy: #8B0000; /* Deep Burgundy/Crimson (Secondary Background) */
            --fssc-light-blue: #E8EAF6; /* Lighter Blue for bot messages */
            --fssc-light-gold-bg: #FFFBE6; /* Very light gold for user messages background */
            --fssc-gold-border: #FFECB3; /* Subtle gold border for user messages */
            --fssc-dark-text: #212121;
            --fssc-light-text: #FFFFFF;
            --fssc-border-light: #CFD8DC; /* Light grey for general borders */
            --fssc-red-alert: #D32F2F; /* Red for alert/start button */
            --fssc-header-height: 80px; /* Height for the header */
        }

        body {
            font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #ECEFF1;
            color: var(--fssc-dark-text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .chat-container {
            background-color: var(--fssc-light-text);
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 750px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--fssc-border-light);
        }
        .chat-header {
            background-color: var(--fssc-navy);
            color: var(--fssc-light-text);
            padding: 10px 25px; /* Adjusted padding */
            font-size: 1.4em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            letter-spacing: 0.5px;
            height: var(--fssc-header-height); /* Fixed height */
            box-sizing: border-box; /* Include padding in height */
        }
        .header-content {
            display: flex;
            align-items: center;
        }
        .fssc-logo {
            height: 60px; /* Adjust height as needed for the logo */
            width: auto;
            margin-right: 15px;
            cursor: pointer; /* Indicates it's clickable */
            transition: transform 0.2s ease;
        }
        .fssc-logo:hover {
            transform: scale(1.03);
        }
        .start-case-btn {
            background-color: var(--fssc-red-alert);
            color: var(--fssc-light-text);
            border: 1px solid var(--fssc-burgundy);
            border-radius: 4px;
            padding: 10px 18px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .start-case-btn:hover {
            background-color: #b71c1c;
            transform: translateY(-1px);
        }
        .chat-messages {
            flex-grow: 1;
            padding: 20px 25px;
            overflow-y: auto;
            max-height: calc(100vh - var(--fssc-header-height) - 100px); /* Dynamic height */
            border-bottom: 1px solid var(--fssc-border-light);
            display: flex;
            flex-direction: column;
            background-color: #FDFDFD;
        }
        .message {
            margin-bottom: 18px;
            padding: 12px 18px;
            border-radius: 20px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.5;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Subtle shadow for messages */
        }
        .bot-message {
            background-color: var(--fssc-light-blue);
            color: var(--fssc-dark-text);
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        .user-message {
            background-color: var(--fssc-light-gold-bg);
            color: var(--fssc-dark-text);
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 4px;
            border: 1px solid var(--fssc-gold-border); /* Gold border for user messages */
        }
        .chat-input-area {
            display: flex;
            padding: 15px 25px;
            border-top: 1px solid var(--fssc-border-light);
            background-color: #F8F8F8;
        }
        .chat-input-area input {
            flex-grow: 1;
            padding: 12px 18px;
            border: 1px solid var(--fssc-border-light);
            border-radius: 25px;
            font-size: 1em;
            margin-right: 12px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .chat-input-area input:focus {
            border-color: var(--fssc-navy);
            box-shadow: 0 0 0 2px rgba(26, 35, 126, 0.2);
        }
        .chat-input-area button {
            background-color: var(--fssc-navy);
            color: var(--fssc-light-text);
            border: none;
            border-radius: 25px;
            padding: 12px 22px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .chat-input-area button:hover {
            background-color: #111A60;
            transform: translateY(-1px);
        }
        .verdict {
            background-color: var(--fssc-burgundy);
            color: var(--fssc-light-text);
            border: 2px solid var(--fssc-gold);
            padding: 25px;
            margin-top: 25px;
            text-align: center;
            font-size: 1.2em;
            border-radius: 8px;
            animation: fadeIn 1s ease-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .verdict strong {
            color: var(--fssc-gold);
            font-size: 1.4em;
            display: block;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .verdict h3 {
            color: var(--fssc-gold);
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.8em;
            letter-spacing: 1px;
        }
        .dispute-options button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: var(--fssc-navy);
            color: var(--fssc-light-text);
            border: 1px solid var(--fssc-gold);
            border-radius: 5px;
            text-align: left;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .dispute-options button:hover {
            background-color: #111A60;
            border-color: var(--fssc-gold);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-content">
                <img src="https://github.com/ingramjam/fssc/blob/main/fssc.png?raw=true" alt="FSSC Logo" class="fssc-logo" id="fsscLogo">
                FSSC Judge Bot
            </div>
            <button id="startCaseBtn" class="start-case-btn">Start New Case</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="bot-message message">Click "Start New Case" to begin your trial.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Type your response here...">
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const startCaseBtn = document.getElementById('startCaseBtn');
        const fsscLogo = document.getElementById('fsscLogo'); // Get the logo element

        let userName = '';
        let leagueName = '';
        let tradeDetails = {};
        let conversationStep = 0; // 0: Awaiting start, 1: Asking name, etc.
        let collusionIndicators = 0;
        let selectedDispute = ''; // To store which dispute is being handled

        const leagueRules = {
            trade_veto_rule: "Trades can be vetoed by a simple majority vote of active league members. The Commissioner also holds final veto power in cases of clear collusion."
        };

        const disputes = [
            { id: 'trade_collusion', name: '1. Trade Collusion / Unfair Trade Practice' },
            { id: 'waiver_wire', name: '2. Waiver Wire / Free Agency Rules (Coming Soon!)' },
            { id: 'ir_abuse', name: '3. Injured Reserve (IR) Slot Abuse (Coming Soon!)' },
            // Add more disputes here as you implement them
        ];

        function addMessage(sender, message, type) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message', type);
            msgDiv.innerHTML = message;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function botResponse(message, isFinal = false, enableInput = true) {
            setTimeout(() => {
                addMessage('bot', message, 'bot-message');
                userInput.disabled = !enableInput || isFinal;
                sendBtn.disabled = !enableInput || isFinal;
                if (enableInput && !isFinal) {
                    userInput.focus();
                }
            }, 500);
        }

        function resetChat() {
            chatMessages.innerHTML = '';
            userName = '';
            leagueName = '';
            tradeDetails = {};
            conversationStep = 0;
            collusionIndicators = 0;
            selectedDispute = '';
            botResponse(`Click "Start New Case" to begin your trial.`, false, false); // Disable input until start
            startCaseBtn.style.display = 'inline-block'; // Ensure button is visible
        }


        function startCaseFlow() {
            chatMessages.innerHTML = ''; // Clear previous messages
            startCaseBtn.style.display = 'none'; // Hide the start button
            botResponse(`Welcome to the FSSC. I am Judge Bot, your impartial arbiter. Please state your name:`, false, true);
            conversationStep = 1; // Move to the first actual input step
        }

        function displayDisputeOptions() {
            let optionsHtml = "<p>Please select the dispute you wish to address:</p><div class='dispute-options'>";
            disputes.forEach(dispute => {
                optionsHtml += `<button data-dispute-id="${dispute.id}">${dispute.name}</button>`;
            });
            optionsHtml += "</div>";
            botResponse(optionsHtml, false, false); // Input disabled, user must click button

            setTimeout(() => { // Attach event listeners after buttons are rendered
                document.querySelectorAll('.dispute-options button').forEach(button => {
                    button.onclick = (event) => {
                        const disputeId = event.target.dataset.disputeId;
                        if (disputeId === 'trade_collusion') {
                            selectedDispute = 'trade_collusion';
                            chatMessages.innerHTML = ''; // Clear options
                            botResponse(`You have selected 'Trade Collusion / Unfair Trade Practice'.`, false, true);
                            setTimeout(() => {
                                botResponse(`A dispute has been filed concerning your recent trade, ${userName}. The charge is **Trade Collusion / Unfair Trade Practice**. Are you prepared to present your case? (Type 'yes' or 'no')`);
                                conversationStep = 3; // Jump to dispute-specific flow
                            }, 1000);
                        } else {
                            botResponse(`That dispute is still under development. Please select an available option.`, false, false); // Keep input disabled
                        }
                    };
                });
            }, 600);
        }

        function processConversation(input) {
            switch (conversationStep) {
                case 0:
                    break;
                case 1: // User provides Name
                    userName = input;
                    botResponse(`And the name of your league?`);
                    conversationStep++;
                    break;
                case 2: // League Name
                    leagueName = input;
                    botResponse(`Thank you, ${userName} from the '${leagueName}' league.`);
                    setTimeout(() => {
                        displayDisputeOptions(); // Present the 11 options here
                    }, 1000);
                    conversationStep++; // This step is now for dispute selection via buttons
                    break;
                // --- Trade Collusion Dispute Specific Flow (conversationStep 3 onwards) ---
                case 3: // Prepared?
                    if (input.toLowerCase() === 'yes') {
                        botResponse(`Excellent. Let's begin.<br><br>--- Phase 1: Trade Details & Initial Intent ---<br>State the full details of the trade in question. List the players you RECEIVED:`);
                        conversationStep++;
                    } else {
                        botResponse(`Please return when you are prepared to present your case.`, true);
                    }
                    break;
                case 4: // Players Received
                    tradeDetails.received = input;
                    botResponse(`And the players you SENT:`);
                    conversationStep++;
                    break;
                case 5: // Players Sent
                    tradeDetails.sent = input;
                    botResponse(`Identify the opposing owner in this trade:`);
                    conversationStep++;
                    break;
                case 6: // Opposing Owner
                    tradeDetails.opposingOwner = input;
                    botResponse(`Describe your primary motivation for this trade. What were you hoping to achieve for your team, ${userName}?`);
                    conversationStep++;
                    break;
                case 7: // User Motivation
                    tradeDetails.userMotivation = input;
                    botResponse(`And what was your understanding of ${tradeDetails.opposingOwner}'s motivation for making this trade?`);
                    conversationStep++;
                    break;
                case 8: // Opposing Motivation
                    tradeDetails.opposingMotivation = input;
                    botResponse(`--- Phase 2: Perceived Fairness & League Impact ---<br>Did you believe this trade was fair and beneficial for *both* teams at the time it was proposed and accepted? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 9: // Believed Fair
                    tradeDetails.believedFair = input.toLowerCase();
                    if (tradeDetails.believedFair === 'no') collusionIndicators += 0.5;
                    botResponse(`Were there any pre-existing agreements, understandings, or communications between you and the opposing owner (not directly related to this trade) that might influence its perception? This includes discussions about future trades, draft picks, or player 'favors'. (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 10: // Pre-existing agreements
                    tradeDetails.preExistingAgreements = input.toLowerCase();
                    if (tradeDetails.preExistingAgreements === 'yes') collusionIndicators += 0.5;
                    botResponse(`Did you discuss this trade with any other league members before or after it was accepted, beyond casual conversation? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 11: // Discussed with others
                    tradeDetails.discussedWithOthers = input.toLowerCase();
                    botResponse(`--- Phase 3: Addressing Collusion Accusations ---<br>Do you have any relationship with ${tradeDetails.opposingOwner} outside of fantasy football that might lead to a perception of bias or favoritism? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 12: // Relationship outside fantasy
                    tradeDetails.relationship = input.toLowerCase();
                    botResponse(`Did you or the opposing owner stand to gain any non-fantasy related benefit from this trade (e.g., money, favors, quid pro quo outside the league)? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 13: // Non-fantasy benefit
                    tradeDetails.nonFantasyBenefit = input.toLowerCase();
                    if (tradeDetails.nonFantasyBenefit === 'yes') collusionIndicators += 2;
                    botResponse(`Was there any discussion between you and the opposing owner about one of you dropping out of the league or giving up on the season *before* this trade? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 14: // Giving up season
                    tradeDetails.givingUpSeason = input.toLowerCase();
                    if (tradeDetails.givingUpSeason === 'yes') collusionIndicators += 2;
                    botResponse(`--- Phase 4: League Rules & Precedent ---<br>Your league's stated rule for trade vetoes is: '${leagueRules.trade_veto_rule}'. Do you agree with this rule description? If not, please state your understanding:`);
                    conversationStep++;
                    break;
                case 15: // Agree with rule / Precedent
                    tradeDetails.ruleUnderstanding = input;
                    botResponse(`Has your league previously set a precedent for what constitutes a 'collusive' or 'unfair' trade that was vetoed or reversed? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 16: // Precedent exists
                    tradeDetails.precedentExists = input.toLowerCase();
                    if (tradeDetails.precedentExists === 'yes') {
                        botResponse(`Please describe that precedent briefly:`);
                        conversationStep++;
                    } else {
                        conversationStep = 18;
                        botResponse(`Thank you for your testimony, ${userName}. Do you have any final statement you wish to make to the Fantasy Sports Supreme Court regarding this dispute?`);
                    }
                    break;
                case 17: // Describe precedent
                    tradeDetails.precedentDescription = input;
                    botResponse(`Thank you for your testimony, ${userName}. Do you have any final statement you wish to make to the Fantasy Sports Supreme Court regarding this dispute?`);
                    conversationStep++;
                    break;
                case 18: // Final Statement
                    tradeDetails.finalStatement = input;
                    botResponse(`Your testimony has been recorded and reviewed. The FSSC Judge Bot will now deliberate based on the evidence presented and the established rules of fantasy football and your league. Please wait.`, true);
                    setTimeout(deliverVerdict, 3000);
                    break;
            }
        }

        function deliverVerdict() {
            let verdictType = "NOT GUILTY of Trade Collusion.";
            let ruling = "";

            if (collusionIndicators >= 1.5) {
                verdictType = "GUILTY of Trade Collusion.";
                ruling = `The trade involving ${tradeDetails.received} (received by you) and ${tradeDetails.sent} (sent by you) is **REVERSED**, and players will be returned to their original teams. The FSSC finds clear indicators of actions outside the spirit of fair play.`;
            } else if (tradeDetails.believedFair === 'no' && collusionIndicators < 1.5) {
                 verdictType = "GUILTY of Unfair Trade Practice (though not necessarily Collusion).";
                 ruling = `While direct collusion was not definitively proven, the trade involving ${tradeDetails.received} and ${tradeDetails.sent} is deemed significantly unbalanced and **REVERSED** to maintain competitive integrity based on your own admission of it not being fair for both sides.`;
            }
            else {
                verdictType = "NOT GUILTY of Trade Collusion.";
                ruling = `The trade involving ${tradeDetails.received} and ${tradeDetails.sent} **STANDS** and is deemed a fair and strategic transaction within the competitive spirit of fantasy football.`;
            }

            const verdictMessage = `
                <div class="verdict">
                    <p>The Fantasy Sports Supreme Court has reached a verdict in the case of **${leagueName} League, ${userName}'s Trade vs. Collusion Allegations.**</p>
                    <p>Based on the evidence presented, the FSSC Judge Bot finds:</p>
                    <h3>**VERDICT:** <strong>${verdictType}</strong></h3>
                    <p><strong>RULING:</strong> ${ruling}</p>
                    <p>This ruling is final and binding for the '${leagueName}' league. Thank you for your cooperation, ${userName}.</p>
                </div>
            `;
            addMessage('bot', verdictMessage, 'bot-message');
            startCaseBtn.style.display = 'inline-block'; // Re-enable "Start New Case" button after verdict
        }


        // Event Listeners
        sendBtn.addEventListener('click', handleUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !userInput.disabled) {
                handleUserInput();
            }
        });
        startCaseBtn.addEventListener('click', startCaseFlow);
        fsscLogo.addEventListener('click', resetChat); // Logo now triggers resetChat


        // Initial state on page load
        document.addEventListener('DOMContentLoaded', () => {
            resetChat(); // Puts the initial "Click Start New Case" message and disables input
        });
    </script>
</body>
</html>
