<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSSC Judge Bot - Sample Trial</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .chat-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .chat-header {
            background-color: #004d40; /* Dark Teal */
            color: #fff;
            padding: 15px 20px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 60vh; /* Adjust as needed */
            border-bottom: 1px solid #eee;
        }
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .bot-message {
            background-color: #e0f2f1; /* Light Teal */
            color: #004d40;
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 2px;
        }
        .user-message {
            background-color: #c8e6c9; /* Light Green */
            color: #2e7d32; /* Dark Green */
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 2px;
        }
        .chat-input-area {
            display: flex;
            padding: 15px 20px;
            border-top: 1px solid #eee;
        }
        .chat-input-area input {
            flex-grow: 1;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 1em;
            margin-right: 10px;
            outline: none;
        }
        .chat-input-area button {
            background-color: #00796b; /* Medium Teal */
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .chat-input-area button:hover {
            background-color: #004d40;
        }
        .verdict {
            background-color: #fff3e0;
            border: 2px solid #ff9800;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.1em;
            border-radius: 8px;
            animation: fadeIn 1s ease-out;
        }
        .verdict strong {
            color: #d32f2f; /* Red for emphasis */
            font-size: 1.3em;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">FSSC Judge Bot</div>
        <div class="chat-messages" id="chatMessages">
            </div>
        <div class="chat-input-area">
            <input type="text" id="userInput" placeholder="Type your response here..." disabled>
            <button id="sendBtn" disabled>Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        let userName = '';
        let leagueName = '';
        let tradeDetails = {}; // To store trade-specific info
        let conversationStep = 0;
        let collusionIndicators = 0;

        // Dummy league rules (could be loaded from external JSON if served via web server)
        const leagueRules = {
            trade_veto_rule: "Trades can be vetoed by a simple majority vote of active league members. The Commissioner also holds final veto power in cases of clear collusion."
        };

        function addMessage(sender, message, type) {
            const msgDiv = document.createElement('div');
            msgDiv.classList.add('message', type);
            msgDiv.innerHTML = message;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
        }

        function botResponse(message, isFinal = false) {
            setTimeout(() => {
                addMessage('bot', message, 'bot-message');
                if (!isFinal) {
                    userInput.disabled = false;
                    sendBtn.disabled = false;
                    userInput.focus();
                } else {
                    userInput.disabled = true;
                    sendBtn.disabled = true;
                }
            }, 500); // Simulate bot "thinking" time
        }

        function handleUserInput() {
            const input = userInput.value.trim();
            if (input === '') return;

            addMessage('user', input, 'user-message');
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;

            processConversation(input);
        }

        function processConversation(input) {
            switch (conversationStep) {
                case 0: // Welcome & Name
                    userName = input;
                    botResponse(`And the name of your league?`);
                    conversationStep++;
                    break;
                case 1: // League Name
                    leagueName = input;
                    botResponse(`Thank you, ${userName} from the '${leagueName}' league.`);
                    setTimeout(() => {
                        botResponse(`A dispute has been filed concerning your recent trade, ${userName}. The charge is **Trade Collusion / Unfair Trade Practice**. Are you prepared to present your case? (Type 'yes' or 'no')`);
                    }, 1000);
                    conversationStep++;
                    break;
                case 2: // Prepared?
                    if (input.toLowerCase() === 'yes') {
                        botResponse(`Excellent. Let's begin.<br><br>--- Phase 1: Trade Details & Initial Intent ---<br>State the full details of the trade in question. List the players you RECEIVED:`);
                        conversationStep++;
                    } else {
                        botResponse(`Please return when you are prepared to present your case.`, true);
                    }
                    break;
                case 3: // Players Received
                    tradeDetails.received = input;
                    botResponse(`And the players you SENT:`);
                    conversationStep++;
                    break;
                case 4: // Players Sent
                    tradeDetails.sent = input;
                    botResponse(`Identify the opposing owner in this trade:`);
                    conversationStep++;
                    break;
                case 5: // Opposing Owner
                    tradeDetails.opposingOwner = input;
                    botResponse(`Describe your primary motivation for this trade. What were you hoping to achieve for your team, ${userName}?`);
                    conversationStep++;
                    break;
                case 6: // User Motivation
                    tradeDetails.userMotivation = input;
                    botResponse(`And what was your understanding of ${tradeDetails.opposingOwner}'s motivation for making this trade?`);
                    conversationStep++;
                    break;
                case 7: // Opposing Motivation
                    tradeDetails.opposingMotivation = input;
                    botResponse(`--- Phase 2: Perceived Fairness & League Impact ---<br>Did you believe this trade was fair and beneficial for *both* teams at the time it was proposed and accepted? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 8: // Believed Fair
                    tradeDetails.believedFair = input.toLowerCase();
                    if (tradeDetails.believedFair === 'no') collusionIndicators += 0.5; // Minor indicator if user admits it wasn't fair
                    botResponse(`Were there any pre-existing agreements, understandings, or communications between you and the opposing owner (not directly related to this trade) that might influence its perception? This includes discussions about future trades, draft picks, or player 'favors'. (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 9: // Pre-existing agreements
                    tradeDetails.preExistingAgreements = input.toLowerCase();
                    if (tradeDetails.preExistingAgreements === 'yes') collusionIndicators += 0.5;
                    botResponse(`Did you discuss this trade with any other league members before or after it was accepted, beyond casual conversation? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 10: // Discussed with others
                    tradeDetails.discussedWithOthers = input.toLowerCase();
                    botResponse(`--- Phase 3: Addressing Collusion Accusations ---<br>Do you have any relationship with ${tradeDetails.opposingOwner} outside of fantasy football that might lead to a perception of bias or favoritism? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 11: // Relationship outside fantasy
                    tradeDetails.relationship = input.toLowerCase();
                    botResponse(`Did you or the opposing owner stand to gain any non-fantasy related benefit from this trade (e.g., money, favors, quid pro quo outside the league)? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 12: // Non-fantasy benefit
                    tradeDetails.nonFantasyBenefit = input.toLowerCase();
                    if (tradeDetails.nonFantasyBenefit === 'yes') collusionIndicators += 2; // Strong indicator
                    botResponse(`Was there any discussion between you and the opposing owner about one of you dropping out of the league or giving up on the season *before* this trade? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 13: // Giving up season
                    tradeDetails.givingUpSeason = input.toLowerCase();
                    if (tradeDetails.givingUpSeason === 'yes') collusionIndicators += 2; // Strong indicator
                    botResponse(`--- Phase 4: League Rules & Precedent ---<br>Your league's stated rule for trade vetoes is: '${leagueRules.trade_veto_rule}'. Do you agree with this rule description? If not, please state your understanding:`);
                    conversationStep++;
                    break;
                case 14: // Agree with rule / Precedent
                    tradeDetails.ruleUnderstanding = input; // User's understanding
                    botResponse(`Has your league previously set a precedent for what constitutes a 'collusive' or 'unfair' trade that was vetoed or reversed? (Type 'yes' or 'no')`);
                    conversationStep++;
                    break;
                case 15: // Precedent exists
                    tradeDetails.precedentExists = input.toLowerCase();
                    if (tradeDetails.precedentExists === 'yes') {
                        botResponse(`Please describe that precedent briefly:`);
                    } else {
                        // Skip directly to final statement if no precedent
                        conversationStep = 17; // Jump to final statement
                        botResponse(`Thank you for your testimony, ${userName}. Do you have any final statement you wish to make to the Fantasy Sports Supreme Court regarding this dispute?`);
                    }
                    break;
                case 16: // Describe precedent
                    tradeDetails.precedentDescription = input;
                    botResponse(`Thank you for your testimony, ${userName}. Do you have any final statement you wish to make to the Fantasy Sports Supreme Court regarding this dispute?`);
                    conversationStep++; // Move to final statement after description
                    break;
                case 17: // Final Statement
                    tradeDetails.finalStatement = input;
                    botResponse(`Your testimony has been recorded and reviewed. The FSSC Judge Bot will now deliberate based on the evidence presented and the established rules of fantasy football and your league. Please wait.`, true);
                    setTimeout(deliverVerdict, 3000); // Simulate deliberation
                    conversationStep++; // Mark as completed
                    break;
            }
        }

        function deliverVerdict() {
            let verdict = "";
            let ruling = "";
            let verdictType = "NOT GUILTY of Trade Collusion.";

            if (collusionIndicators >= 1.5) { // Adjusted threshold for this simplified demo
                verdictType = "GUILTY of Trade Collusion.";
                ruling = `The trade involving ${tradeDetails.received} (received by you) and ${tradeDetails.sent} (sent by you) is **REVERSED**, and players will be returned to their original teams. The FSSC finds clear indicators of actions outside the spirit of fair play.`;
            } else if (tradeDetails.believedFair === 'no' && collusionIndicators < 1.5) {
                 verdictType = "GUILTY of Unfair Trade Practice (though not necessarily Collusion).";
                 ruling = `While direct collusion was not definitively proven, the trade involving ${tradeDetails.received} and ${tradeDetails.sent} is deemed significantly unbalanced and **REVERSED** to maintain competitive integrity based on your own admission of it not being fair for both sides.`;
            }
            else {
                verdictType = "NOT GUILTY of Trade Collusion.";
                ruling = `The trade involving ${tradeDetails.received} and ${tradeDetails.sent} **STANDS** and is deemed a fair and strategic transaction within the competitive spirit of fantasy football.`;
            }

            const verdictMessage = `
                <div class="verdict">
                    <p>The Fantasy Sports Supreme Court has reached a verdict in the case of **${leagueName} League, ${userName}'s Trade vs. Collusion Allegations.**</p>
                    <p>Based on the evidence presented, the FSSC Judge Bot finds:</p>
                    <h3>**VERDICT:** <strong>${verdictType}</strong></h3>
                    <p><strong>RULING:</strong> ${ruling}</p>
                    <p>This ruling is final and binding for the '${leagueName}' league. Thank you for your cooperation, ${userName}.</p>
                </div>
            `;
            addMessage('bot', verdictMessage, 'bot-message');
        }


        // Event Listeners
        sendBtn.addEventListener('click', handleUserInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !userInput.disabled) {
                handleUserInput();
            }
        });

        // Initial welcome message
        botResponse(`Welcome to the FSSC. I am Judge Bot, your impartial arbiter. Please state your name:`);

    </script>
</body>
</html>
